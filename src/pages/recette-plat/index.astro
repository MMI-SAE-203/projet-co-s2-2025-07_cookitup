---
import Layout from "../../layouts/Layout.astro";
import Plat from "../../components/Plat.astro";
import PlatFavoris from "../../components/PlatFavoris.astro";
import { Image } from "astro:assets";
// ✅ CHANGEZ LE CHEMIN VERS VOTRE IMAGE
import imagePouletRoti from "../../assets/img/recettes/poulet_roti.png"; // ← CHANGE: votre vraie image
import { getAllRecettes, getFavorisRecettes } from "../../js/backend.mjs";

// ✅ RÉCUPÉRATION DES DONNÉES DEPUIS VOTRE POCKETBASE
const recettes = await getAllRecettes();
const favoris = await getFavorisRecettes();

console.log("Recettes récupérées:", recettes.length); // ← DEBUG: pour vérifier
console.log("Favoris récupérés:", favoris.length); // ← DEBUG: pour vérifier
---

<Layout>
    <!-- Slider principal -->
    <section class="relative w-full">
        <div class="slider-slide">
            <Image
                src={imagePouletRoti || "/placeholder.svg"}
                alt="Poulet rôti"
                class="w-full h-[400px] object-cover"
            />
            <div
                class="absolute inset-0 flex flex-col items-center justify-center text-white bg-black bg-opacity-40 px-4"
            >
                <h2 class="text-3xl md:text-5xl font-bold mb-4">POULET ROTI</h2>
                <a
                    href="/recette-plat/poulet-roti"
                    class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold px-6 py-2 rounded-full text-sm shadow-md transition"
                >
                    VOIR LA RECETTE
                </a>
            </div>
        </div>

        <!-- Navigation du slider -->
        <button
            class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-white p-2 rounded-full hover:bg-gray-100 transition"
            id="prevSlide"
        >
            <span>&lt;</span>
        </button>
        <button
            class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-white p-2 rounded-full hover:bg-gray-100 transition"
            id="nextSlide"
        >
            <span>&gt;</span>
        </button>

        <div class="absolute bottom-4 w-full flex justify-center gap-2">
            <div class="w-3 h-3 rounded-full bg-black slider-dot"></div>
            <div class="w-3 h-3 rounded-full bg-white opacity-60 slider-dot">
            </div>
        </div>
    </section>

    <!-- Section Favoris -->
    <section class="bg-[#C2584F] text-white py-12 px-6 relative">
        <h2 class="text-xl md:text-3xl font-bold uppercase mb-8">
            Nos favoris du moments
        </h2>

        <div
            class="flex gap-4 overflow-x-auto snap-x pb-4"
            id="favorisContainer"
        >
            <!-- ✅ UTILISE VOS DONNÉES POCKETBASE -->
            {
                favoris.map((plat) => (
                    <PlatFavoris
                        id={plat.id}
                        nom={plat.nom}
                        img={plat.image}
                    />
                ))
            }
        </div>

        <!-- Navigation favoris -->
        <button
            class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white text-black p-2 rounded-full shadow-lg hover:bg-gray-100 transition"
            id="prevFavoris"
        >
            &lt;
        </button>
        <button
            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white text-black p-2 rounded-full shadow-lg hover:bg-gray-100 transition"
            id="nextFavoris"
        >
            &gt;
        </button>
    </section>

    <!-- Section Autres recettes -->
    <section class="py-12 px-6">
        <h2 class="text-xl md:text-3xl font-bold mb-4">
            D'autre recette à portée de main
        </h2>
        <p class="mb-6 text-gray-600">
            Choisissez parmi une grande liste de plats celui qui vous
            correspond, et lancez-vous !
        </p>

        <!-- Barre de recherche et filtres -->
        <div class="mb-8 flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <input
                    type="text"
                    placeholder="Trouvez une recette"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500"
                    id="searchInput"
                />
            </div>
            <div class="flex gap-2">
                <select
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500"
                    id="filterSelect"
                >
                    <option>Tous les types</option>
                    <option>Favoris seulement</option>
                    <option>Sponsorisés</option>
                </select>
                <select
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500"
                    id="sortSelect"
                >
                    <option>Trier par</option>
                    <option>Nom A-Z</option>
                    <option>Plus récent</option>
                    <option>Temps de préparation</option>
                </select>
            </div>
        </div>

        <!-- ✅ GRILLE DES RECETTES AVEC VOS DONNÉES -->
        <div
            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
            id="recettesGrid"
        >
            {
                recettes.map((plat) => (
                    <Plat
                        id={plat.id}
                        nom={plat.nom}
                        img={plat.image}
                        temps_prep={plat.temps_preparation}
                        favori={plat.favori}
                        sponsorise={plat.expand?.sponsorise}
                    />
                ))
            }
        </div>

        <!-- Container pour la pagination -->
        <div class="pagination-container"></div>
    </section>

    <!-- Section Favoris en bas -->
    <section class="bg-green-600 text-white py-12 px-6 text-center">
        <h2 class="text-2xl md:text-3xl font-bold mb-4">
            RETROUVEZ VOS FAVORIS ICI
        </h2>
        <p class="mb-6">
            Retrouvez toutes vos recettes favorites ici et régalez-vous avec des
            plats savoureux et faciles à réaliser !
        </p>
        <a
            href="/favoris"
            class="inline-block bg-white text-green-600 font-bold px-6 py-3 rounded-full hover:bg-gray-100 transition"
        >
            Visitez vos favoris
        </a>
    </section>
</Layout>

<script>
    import {
        initMainSlider,
        initFavorisCarousel,
    } from "../../js/recettes/slider-carousel.js";
    import {
        initSearchAndFilters,
        initFavorisToggle,
    } from "../../js/recettes/search-filters.js";
    import { initPagination } from "../../js/recettes/pagination.js";

    // ✅ INITIALISATION QUAND LE DOM EST CHARGÉ
    document.addEventListener("DOMContentLoaded", () => {
        initMainSlider();
        initFavorisCarousel();
        initSearchAndFilters();
        initFavorisToggle();
        initPagination();
    });
</script>
