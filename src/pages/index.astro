---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import image_accueil from "../assets/img/accueil/img_page_accueil_hero_1x.webp";
import image_montre from "../assets/img/accueil/image_montre.webp";
import image_pieces from "../assets/img/accueil/image_pieces.webp";
import image_plats from "../assets/img/accueil/plats_page_accueil.webp";
import image_avis from "../assets/img/accueil/image_partager_avis.webp";
import image_robot_ai from "../assets/img/accueil/image_robot_ia.webp";
import image_entree from "../assets/img/accueil/image_entree_source.webp";
import image_entree2 from "../assets/img/accueil/image_entree_layout.webp";
import image_plat from "../assets/img/accueil/image_plat_source.webp";
import image_dessert from "../assets/img/accueil/image_dessert_source.webp";
import image_menu_semaine from "../assets/img/accueil/image_menu_semaine_source.webp";
import pb from "../lib/pocketbase.js";

// R√©cup√©rer les avis du site
let avisSite = [];
try {
    avisSite = await pb.collection('avis_site').getFullList({
        expand: 'user',
        sort: '-created'
    });
} catch (error) {
    console.error('Erreur lors de la r√©cup√©ration des avis:', error);
}
---

<Layout>
	<!-- Section Hero agrandie -->
	<section
		class="relative w-full h-[500px] md:h-[600px] bg-black text-white overflow-hidden"
	>
		<Image
			src={image_accueil || "/placeholder.svg"}
			alt="Image cuisine fond"
			class="w-full h-full object-cover"
		/>
		<!-- Overlay sombre pour am√©liorer la lisibilit√© -->
		<div class="absolute inset-0 bg-black/40"></div>
		
		<div class="absolute inset-0 flex items-center px-6 md:px-20 py-0">
			<h1
				class="text-4xl md:text-6xl lg:text-7xl font-bold font-koulen leading-tight relative z-10"
			>
				<span class="block text-white mb-2">NOTRE BUT</span>
				<span class="block text-yellow-400 mb-2">PREMIER VOUS,</span>
				<span class="block text-yellow-400">FAIRE ECONOMISER</span>
			</h1>
		</div>
	</section>

	<!-- Section "Simplifie ta vie culinaire" -->
	<section class="py-16 px-6 text-center bg-white">
		<h2 class="text-3xl md:text-4xl font-koulen uppercase mb-12 text-black">
			Simplifie ta vie culinaire
		</h2>

		<!-- Les 4 cartes -->
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 max-w-7xl mx-auto">
			<!-- Carte 1 - Gain de temps -->
			<div class="flex flex-col items-center bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
				<Image
					src={image_montre || "/placeholder.svg"}
					alt="gain de temps"
					class="w-full h-48 object-cover rounded-lg mb-4"
				/>
				<h3 class="font-bold text-lg mb-3 text-center text-black">
					un gain de temps pour tous
				</h3>
				<p class="text-sm text-gray-700 text-center leading-relaxed">
					Transformez facilement les ingr√©dients de votre frigo en
					recettes savoureuses. R√©duisez le gaspillage alimentaire en
					utilisant ce que vous avez sous la main.
				</p>
			</div>

			<!-- Carte 2 - Recettes peu co√ªteuses -->
			<div class="flex flex-col items-center bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
				<Image
					src={image_pieces || "/placeholder.svg"}
					alt="recettes peu couteuses"
					class="w-full h-48 object-cover rounded-lg mb-4"
				/>
				<h3 class="font-bold text-lg mb-3 text-center text-black">
					des recettes peu co√ªteuses
				</h3>
				<p class="text-sm text-gray-700 text-center leading-relaxed">
					Fini les repas hors de prix ! Cuisinez malin avec des
					recettes simples et √©conomiques. Profitez de r√©ductions
					exclusives gr√¢ce √† nos partenariats avec des commerces
					locaux.
				</p>
			</div>

			<!-- Carte 3 - Large choix -->
			<div class="flex flex-col items-center bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
				<Image
					src={image_plats || "/placeholder.svg"}
					alt="choix de recettes"
					class="w-full h-48 object-cover rounded-lg mb-4"
				/>
				<h3 class="font-bold text-lg mb-3 text-center text-black">
					un large choix de recettes
				</h3>
				<p class="text-sm text-gray-700 text-center leading-relaxed">
					Indiquez vos objectifs et suivez vos calories facilement.
					Obtenez des repas √©quilibr√©s et adapt√©s √† votre r√©gime
					alimentaire.
				</p>
			</div>

			<!-- Carte 4 - Partager avis -->
			<div class="flex flex-col items-center bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
				<Image
					src={image_avis || "/placeholder.svg"}
					alt="avis"
					class="w-full h-48 object-cover rounded-lg mb-4"
				/>
				<h3 class="font-bold text-lg mb-3 text-center text-black">
					partager vos avis √† d'autres
				</h3>
				<p class="text-sm text-gray-700 text-center leading-relaxed">
					Partagez vos recettes et d√©couvrez celles des autres
					√©tudiants. Rejoignez un mouvement pour mieux manger et
					gaspiller moins.
				</p>
			</div>
		</div>
	</section>

	<!-- Section abonnement -->
<section class="bg-teal-600 text-white py-16 px-6 text-center">
	<h2 class="text-3xl md:text-4xl font-koulen uppercase mb-12">
		Fais partie de l'aventure, abonne-toi !
	</h2>

	<!-- Contenu en deux colonnes avec boutons align√©s -->
	<div class="flex flex-col md:flex-row justify-center gap-8 max-w-6xl mx-auto">
		<!-- Colonne Compte gratuit -->
		<div class="flex-1 text-left">
			<!-- Bouton Compte gratuit align√© √† gauche -->
			<div class="mb-8">
				<a 
					href="/inscription"
					class="inline-block bg-transparent border-2 border-white text-white font-bold py-3 px-8 rounded-full hover:bg-white hover:text-teal-600 transition-all duration-300 text-lg"
				>
					Compte gratuit
				</a>
			</div>
			
			<ul class="list-disc list-inside space-y-3 text-base">
				<li>Trouvez des recettes avec les ingr√©dients du frigo.</li>
				<li>√âchangez recettes et astuces entre √©tudiants.</li>
				<li>Liste de courses automatique selon vos besoins.</li>
				<li>Repas vari√©s et ajustables chaque semaine.</li>
				<li>R√©utilisez vos restes pour √©viter le gaspillage.</li>
				<li>Profitez de r√©ductions chez nos partenaires locaux.</li>
			</ul>
		</div>

		<!-- Colonne Pass CookUP -->
		<div class="flex-1 text-left">
			<!-- Bouton Pass CookUP align√© √† gauche -->
			<div class="mb-8">
				<a 
					href="/cookup"
					class="inline-block bg-transparent border-2 border-white text-white font-bold py-3 px-8 rounded-full hover:bg-white hover:text-teal-600 transition-all duration-300 text-lg"
				>
					Pass CookUP
				</a>
			</div>
			
			<ul class="list-disc list-inside space-y-3 text-base">
				<li>Inclut toutes les fonctionnalit√©s de la version gratuite.</li>
				<li>Calcul automatique selon ingr√©dients et quantit√©s.</li>
				<li>Recommandations adapt√©es √† vos objectifs.</li>
				<li>Menu optimis√© selon r√©gime et pr√©f√©rences.</li>
				<li>Acc√©dez √† des nutritionnistes partenaires.</li>
			</ul>
		</div>
	</div>
</section>

	<!-- Section IA qui simplifie ta vie (avec fond blanc comme dans la capture d'√©cran) -->
	<section class="py-16 px-6 md:px-20 bg-white">
		<div
			class="max-w-6xl mx-auto flex flex-col md:flex-row items-center gap-10"
		>
			<!-- Texte -->
			<div class="flex-1 text-left">
				<h2
					class="text-emerald-600 text-3xl md:text-4xl font-koulen uppercase mb-6"
				>
					L'IA QUI SIMPLIFIE TA VIE
				</h2>
				<p
					class="text-black text-base md:text-lg leading-relaxed"
				>
					Notre IA t'accompagne dans ton suivi nutritionnel en cr√©ant
					un planning d√©taill√© de tes repas pour la semaine. Elle optimise
					tes ingr√©dients restants et s'adapte √† ton budget, tout en
					te proposant des conseils personnalis√©s. Plus besoin de
					te creuser la t√™te, elle planifie pour toi !
				</p>
			</div>

			<!-- Image avec bordure verte en bas -->
			<div class="flex-1 relative">
				<div class="relative rounded-lg overflow-hidden shadow-lg">
					<Image
						src={image_robot_ai || "/placeholder.svg"}
						alt="Illustration IA robot cuisinier"
						class="w-full h-auto"
					/>
					<!-- Bordure verte en bas -->
					<div class="absolute bottom-0 left-0 right-0 h-2 bg-emerald-600"></div>
				</div>
			</div>
		</div>
	</section>

	<!-- Section Recettes avec les cat√©gories (SANS BOISSON) -->
<section class="py-12 px-6 bg-white text-center">
	<h2 class="text-2xl md:text-3xl font-koulen uppercase mb-10">
		D√©couvrez nos recettes
	</h2>
	<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
		<!-- ü•ó Entr√©e -->
		<a href="/recette-plat" class="group relative overflow-hidden rounded-xl shadow-lg h-[400px] cursor-pointer transform transition-transform hover:scale-105">
			<Image
				src={image_entree || "/placeholder.svg"}
				alt="Entr√©e"
				class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
			/>
			<!-- Filtre sombre -->
			<div class="absolute inset-0 bg-black/30 group-hover:bg-black/20 transition-all duration-300 rounded-xl"></div>
			<span
				class="absolute top-0 left-0 h-full w-full flex items-start justify-start text-white text-4xl font-bold p-4 tracking-widest z-10"
			>
				<span class="leading-tight text-left drop-shadow-lg">
					{
						`E\nN\nT\nR\n√â\nE`.split("\n").map((char) => (
							<span>
								{char}
								<br />
							</span>
						))
					}
				</span>
			</span>
		</a>

		<!-- üçΩ Plat -->
		<a href="/recette-plat" class="group relative overflow-hidden rounded-xl shadow-lg h-[400px] cursor-pointer transform transition-transform hover:scale-105">
			<Image
				src={image_plat || "/placeholder.svg"}
				alt="Plat"
				class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
			/>
			<!-- Filtre sombre -->
			<div class="absolute inset-0 bg-black/30 group-hover:bg-black/20 transition-all duration-300 rounded-xl"></div>
			<span
				class="absolute top-0 left-0 h-full w-full flex items-start justify-start text-white text-4xl font-bold p-4 tracking-widest z-10"
			>
				<span class="leading-tight text-left drop-shadow-lg">
					{
						`P\nL\nA\nT`.split("\n").map((char) => (
							<span>
								{char}
								<br />
							</span>
						))
					}
				</span>
			</span>
		</a>

		<!-- üç∞ Dessert -->
		<a href="/recette-plat" class="group relative overflow-hidden rounded-xl shadow-lg h-[400px] cursor-pointer transform transition-transform hover:scale-105">
			<Image
				src={image_dessert || "/placeholder.svg"}
				alt="Dessert"
				class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
			/>
			<!-- Filtre sombre -->
			<div class="absolute inset-0 bg-black/30 group-hover:bg-black/20 transition-all duration-300 rounded-xl"></div>
			<span
				class="absolute top-0 left-0 h-full w-full flex items-start justify-start text-white text-4xl font-bold p-4 tracking-widest z-10"
			>
				<span class="leading-tight text-left drop-shadow-lg">
					{
						`D\nE\nS\nS\nE\nR\nT`.split("\n").map((char) => (
							<span>
								{char}
								<br />
								</span>
						))
					}
				</span>
			</span>
		</a>
	</div>

	<!-- Menu de la semaine avec superposition sombre + texte centr√© gauche -->
	<a href="/menu-semaine" class="group relative mt-12 block overflow-hidden rounded-xl shadow-lg cursor-pointer transform transition-transform hover:scale-105">
		<!-- Image de fond -->
		<Image
			src={image_menu_semaine || "/placeholder.svg"}
			alt="Menu de la semaine"
			class="w-full h-96 object-cover transition-transform duration-300 group-hover:scale-110"
		/>

		<!-- Overlay sombre (assombrissement) -->
		<div
			class="absolute top-0 left-0 w-full h-full bg-black/50 group-hover:bg-black/40 transition-all duration-300 rounded-xl z-10"
		>
		</div>

		<!-- Texte superpos√© -->
		<div
			class="absolute top-1/2 left-6 transform -translate-y-1/2 text-white text-xl md:text-2xl font-bold text-left uppercase z-20 max-w-md drop-shadow-lg"
		>
			Menu de la semaine √©quilibr√© & √©conomique
		</div>
	</a>
</section>

	<!-- Carrousel d'avis (remplace le composant Avis) -->
	{avisSite.length > 0 && (
		<section class="bg-red-400 text-white py-16 px-6 mb-16">
			<div class="max-w-4xl mx-auto">
				<div class="relative">
					<!-- Conteneur du carrousel -->
					<div id="avisCarousel" class="overflow-hidden">
						<div id="avisContainer" class="flex transition-transform duration-500 ease-in-out">
							{avisSite.map((avis, index) => {
								const user = avis.expand?.user;
								const userName = user?.name || `${user?.prenom || ''} ${user?.pseudo || ''}`.trim() || 'Utilisateur anonyme';
								
								return (
									<div class="w-full flex-shrink-0 px-8" data-slide={index}>
										<h3 class="text-3xl md:text-4xl font-bold mb-6 uppercase text-left">
											{userName}
										</h3>
										<p class="text-lg md:text-xl leading-relaxed italic text-left">
											{avis.comment}
										</p>
									</div>
								);
							})}
						</div>
					</div>
					
					<!-- Boutons de navigation -->
					<div class="absolute right-4 top-1/2 transform -translate-y-1/2 flex space-x-3">
						<button 
							id="prevAvis"
							class="bg-white/20 hover:bg-white/30 rounded-full p-3 transition"
							aria-label="Avis pr√©c√©dent"
						>
							<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
							</svg>
						</button>
						
						<button 
							id="nextAvis"
							class="bg-white/20 hover:bg-white/30 rounded-full p-3 transition"
							aria-label="Avis suivant"
						>
							<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
							</svg>
						</button>
					</div>
				</div>
				
				<!-- Indicateurs (masqu√©s pour correspondre √† la capture d'√©cran) -->
				<div class="hidden">
					{avisSite.map((_, index) => (
						<button 
							class="avis-indicator w-3 h-3 rounded-full bg-white/40 hover:bg-white/60 transition"
							data-slide={index}
							aria-label={`Aller √† l'avis ${index + 1}`}
						></button>
					))}
				</div>
			</div>
		</section>
	)}
</Layout>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Initialiser le carrousel d'avis
		initAvisCarousel();
	});

	function initAvisCarousel() {
		const container = document.getElementById('avisContainer');
		const prevBtn = document.getElementById('prevAvis');
		const nextBtn = document.getElementById('nextAvis');
		const indicators = document.querySelectorAll('.avis-indicator');
		
		if (!container) return;
		
		let currentSlide = 0;
		const slides = document.querySelectorAll('[data-slide]');
		const totalSlides = slides.length;
		
		function updateCarousel() {
			// D√©placer le conteneur
			const translateX = -currentSlide * 100;
			container.style.transform = `translateX(${translateX}%)`;
			
			// Mettre √† jour les indicateurs
			indicators.forEach((indicator, index) => {
				if (index === currentSlide) {
					indicator.classList.remove('bg-white/40');
					indicator.classList.add('bg-white');
				} else {
					indicator.classList.remove('bg-white');
					indicator.classList.add('bg-white/40');
				}
			});
		}
		
		function nextSlide() {
			currentSlide = (currentSlide + 1) % totalSlides;
			updateCarousel();
		}
		
		function prevSlide() {
			currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
			updateCarousel();
		}
		
		function goToSlide(index) {
			currentSlide = index;
			updateCarousel();
		}
		
		// Event listeners
		nextBtn?.addEventListener('click', nextSlide);
		prevBtn?.addEventListener('click', prevSlide);
		
		indicators.forEach((indicator, index) => {
			indicator.addEventListener('click', () => goToSlide(index));
		});
		
		// Auto-play (optionnel)
		setInterval(nextSlide, 5000);
		
		// Initialiser
		updateCarousel();
	}
</script>
